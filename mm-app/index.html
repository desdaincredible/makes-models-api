<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Makes Models API</title>
</head>
<body>
        <button type="button" onclick="loadXMLDoc()">
                Get Makes Per Year</button>
                <p id="makes"></p>



<!-- <script src="server.js" /> -->
<script>
let masterObj = [
    // year: [make: [models], make: [models]...]

]



// get years    
const d = new Date();
const endingYear = d.getFullYear();
let years = [];
let results = [];

for(let i = 1980; i < endingYear + 2; i++){
    years.push(i);
}

// create api call for each year's makes
let apiLinksArr = [];

function loadXMLDoc() {
    for(let i = 0; i < years.length; i++){
        // console.log(years[i], i, [i])
        let apiLink = "https://www.fueleconomy.gov/ws/rest/vehicle/menu/make?year=" + years[i];
        apiLinksArr.push(apiLink);

        let obj = {};
        obj[years[i]] = years[i];


        // for(let x = 0; x < years.length; x++){
        //     obj[years[i]] = years[i];
        // }
        masterObj.push(obj);
    }
    // console.log(apiLinksArr, 'links arr');
    console.log(masterObj, 'master obj')
    apiCall();
} 







// make api call for each year's makes
function apiCall(){
    const xmlhttp = new XMLHttpRequest();

    apiLinksArr.forEach(link => {
        xmlhttp.open("GET", link , true);
        xmlhttp.send();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                // console.log(this);
                printFunction(this);
            }
        }
    }) 
}

function printFunction(xml) {
    var x, i, xmlDoc, txt;
    xmlDoc = xml.responseXML;
    txt = "";
    x = xmlDoc.getElementsByTagName("text");
    for (i = 0; i< x.length; i++) {
        // console.log(x[i])
        txt += x[i].childNodes[0].nodeValue + "<br>";

        function addElement () { 
        const newDiv = document.createElement("div"); 
        const newContent = document.createTextNode(x[i]); 
        newDiv.appendChild(newContent);  
        var currentDiv = document.getElementById("makes"); 
        document.body.insertBefore(newDiv, currentDiv); 
    }
}
    // document.getElementById("makes").innerHTML = txt;
}

// pull each year's makes x
    // push into their own array/object
// pull each make's models
    // if model was made in year x, add model to that year's object inside the make

</script>
    
</body>
</html>