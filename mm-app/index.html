<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Makes Models API</title>
</head>
<body>
        <button type="button" onclick="loadXMLDoc()">
                Get Makes Per Year</button>
                <p id="makes"></p>



<!-- <script src="server.js" /> -->
<script>
let masterObj = [
    // year: [make: [models], make: [models]...]

]



// get years    
const d = new Date();
const endingYear = d.getFullYear();
let years = [];
let results = [];

for(let i = 1980; i < endingYear + 2; i++){
    years.push(i);
}

// create api call for each year's makes
let apiLinksArr = [];

function loadXMLDoc() {
    // makes
    for(let i = 0; i < years.length; i++){
        // console.log(years[i], i, [i])
        let apiLink = "https://www.fueleconomy.gov/ws/rest/vehicle/menu/make?year=" + years[i];
        apiLinksArr.push(apiLink);

        let obj = {};
        obj[years[i]] = years[i];


        // for(let x = 0; x < years.length; x++){
        //     obj[years[i]] = years[i];
        // }
        masterObj.push(obj);
    }
    // console.log(apiLinksArr, 'links arr');
    // console.log(masterObj, 'master obj')
    apiCall();

    // models
} 

let xmlArr = [];

// make api call for each year's makes
function apiCall(){
    for (let i = 0; i < apiLinksArr.length; i++){
        const xmlhttp = new XMLHttpRequest();

        xmlhttp.open("GET", apiLinksArr[i] , true);
        xmlhttp.send();
        xmlhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                // console.log(this);
                xmlArr.push(this);
                // printFunction(this);

            // let xmlDoc = this.responseXML;
            // let txt = "";
            // let x = xmlDoc.getElementsByTagName("text");
            //     // for (let y = 0; y < x.length; y++) {
            //     //     console.log(link, "link", x[y], "result")
            //     // }
            //         console.log(link, xmlDoc)
            }
        }
    } 

    printFunction(); 
}

function printFunction() {
    // console.log(xmlArr)
    xmlArr.forEach((xml) => {
        console.log(xml, 'xml')
        console.log(xml.responseXML, 'res')

        let xmlDoc = xml.responseXML;
        let txt = "";
        let x = xmlDoc.getElementsByTagName("text");
        for (let y = 0; y < x.length; y++) {
            console.log(x[y])
            txt += x[y].childNodes[0].nodeValue + "<br>";

            function addElement () { 
            const newDiv = document.createElement("div"); 
            const newContent = document.createTextNode(x[y]); 
            newDiv.appendChild(newContent);  
            var currentDiv = document.getElementById("makes"); 
            document.body.insertBefore(newDiv, currentDiv); 
            }
        }
    })

}
    // document.getElementById("makes").innerHTML = txt;


// pull each year's makes x
    // push into their own array/object
// pull each make's models
    // if model was made in year x, add model to that year's object inside the make






</script>
    
</body>
</html>

